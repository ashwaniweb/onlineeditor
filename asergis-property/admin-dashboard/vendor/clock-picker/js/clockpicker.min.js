!function(){function m(a){return document.createElementNS(e,a)}function n(a){return(a<10?"0":"")+a}function p(a){var b=++o+"";return a?a+b:b}function x(b,e){function M(a,b){var g=h.offset(),i=/^touch/.test(a.type),l=g.left+q,m=g.top+q,n=(i?a.originalEvent.touches[0]:a).pageX-l,o=(i?a.originalEvent.touches[0]:a).pageY-m,p=Math.sqrt(n*n+o*o),s=!1;if(!b||!(p<r-t||p>r+t)){a.preventDefault();var u=setTimeout(function(){d.addClass("clockpicker-moving")},200);f&&h.append(C.canvas),C.setHand(n,o,!b,!0),c.off(j).on(j,function(a){a.preventDefault();var b=/^touch/.test(a.type),c=(b?a.originalEvent.touches[0]:a).pageX-l,d=(b?a.originalEvent.touches[0]:a).pageY-m;(s||c!==n||d!==o)&&(s=!0,C.setHand(c,d,!1,!0))}),c.off(k).on(k,function(a){c.off(k),a.preventDefault();var f=/^touch/.test(a.type),g=(f?a.originalEvent.changedTouches[0]:a).pageX-l,i=(f?a.originalEvent.changedTouches[0]:a).pageY-m;(b||s)&&g===n&&i===o&&C.setHand(g,i),"hours"===C.currentView?C.toggleView("minutes",v/2):e.autoclose&&(C.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){C.done()},v/2)),h.prepend(N),clearTimeout(u),d.removeClass("clockpicker-moving"),c.off(j)})}}var g=a(w),h=g.find(".clockpicker-plate"),l=g.find(".clockpicker-hours"),o=g.find(".clockpicker-minutes"),x=g.find(".clockpicker-am-pm-block"),z="INPUT"===b.prop("tagName"),A=z?b:b.find("input"),B=b.find(".input-group-addon"),C=this;if(this.id=p("cp"),this.element=b,this.options=e,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=z,this.input=A,this.addon=B,this.popover=g,this.plate=h,this.hoursView=l,this.minutesView=o,this.amPmBlock=x,this.spanHours=g.find(".clockpicker-span-hours"),this.spanMinutes=g.find(".clockpicker-span-minutes"),this.spanAmPm=g.find(".clockpicker-span-am-pm"),this.amOrPm="PM",e.twelvehour){var E=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");a(E);a('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){C.amOrPm="AM",a(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),a('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){C.amOrPm="PM",a(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}e.autoclose||a('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+e.donetext+"</button>").click(a.proxy(this.done,this)).appendTo(g),"top"!==e.placement&&"bottom"!==e.placement||"top"!==e.align&&"bottom"!==e.align||(e.align="left"),"left"!==e.placement&&"right"!==e.placement||"left"!==e.align&&"right"!==e.align||(e.align="top"),g.addClass(e.placement),g.addClass("clockpicker-align-"+e.align),this.spanHours.click(a.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(a.proxy(this.toggleView,this,"minutes")),A.on("focus.clockpicker click.clockpicker",a.proxy(this.show,this)),B.on("click.clockpicker",a.proxy(this.toggle,this));var H,I,J,K,G=a('<div class="clockpicker-tick"></div>');if(e.twelvehour)for(H=1;H<13;H+=1)I=G.clone(),J=H/6*Math.PI,K=r,I.css("font-size","120%"),I.css({left:q+Math.sin(J)*K-t,top:q-Math.cos(J)*K-t}),I.html(0===H?"00":H),l.append(I),I.on(i,M);else for(H=0;H<24;H+=1){I=G.clone(),J=H/6*Math.PI;var L=H>0&&H<13;K=L?s:r,I.css({left:q+Math.sin(J)*K-t,top:q-Math.cos(J)*K-t}),L&&I.css("font-size","120%"),I.html(0===H?"00":H),l.append(I),I.on(i,M)}for(H=0;H<60;H+=5)I=G.clone(),J=H/30*Math.PI,I.css({left:q+Math.sin(J)*r-t,top:q-Math.cos(J)*r-t}),I.css("font-size","120%"),I.html(n(H)),o.append(I),I.on(i,M);if(h.on(i,function(b){0===a(b.target).closest(".clockpicker-tick").length&&M(b,!0)}),f){var N=g.find(".clockpicker-canvas"),O=m("svg");O.setAttribute("class","clockpicker-svg"),O.setAttribute("width",u),O.setAttribute("height",u);var P=m("g");P.setAttribute("transform","translate("+q+","+q+")");var Q=m("circle");Q.setAttribute("class","clockpicker-canvas-bearing"),Q.setAttribute("cx",0),Q.setAttribute("cy",0),Q.setAttribute("r",2);var R=m("line");R.setAttribute("x1",0),R.setAttribute("y1",0);var S=m("circle");S.setAttribute("class","clockpicker-canvas-bg"),S.setAttribute("r",t);var T=m("circle");T.setAttribute("class","clockpicker-canvas-fg"),T.setAttribute("r",3.5),P.appendChild(R),P.appendChild(S),P.appendChild(T),P.appendChild(Q),O.appendChild(P),N.append(O),this.hand=R,this.bg=S,this.fg=T,this.bearing=Q,this.g=P,this.canvas=N}y(this.options.init)}function y(a){a&&"function"==typeof a&&a()}var d,a=window.jQuery,b=a(window),c=a(document),e="http://www.w3.org/2000/svg",f="SVGAngle"in window&&function(){var a,b=document.createElement("div");return b.innerHTML="<svg/>",a=(b.firstChild&&b.firstChild.namespaceURI)==e,b.innerHTML="",a}(),g=function(){var a=document.createElement("div").style;return"transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a}(),h="ontouchstart"in window,i="mousedown"+(h?" touchstart":""),j="mousemove.clockpicker"+(h?" touchmove.clockpicker":""),k="mouseup.clockpicker"+(h?" touchend.clockpicker":""),l=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,o=0,q=100,r=80,s=54,t=13,u=2*q,v=g?350:1,w=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");x.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},x.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},x.prototype.locate=function(){var a=this.element,b=this.popover,c=a.offset(),d=a.outerWidth(),e=a.outerHeight(),f=this.options.placement,g=this.options.align,h={};switch(b.show(),f){case"bottom":h.top=c.top+e;break;case"right":h.left=c.left+d;break;case"top":h.top=c.top-b.outerHeight();break;case"left":h.left=c.left-b.outerWidth()}switch(g){case"left":h.left=c.left;break;case"right":h.left=c.left+d-b.outerWidth();break;case"top":h.top=c.top;break;case"bottom":h.top=c.top+e-b.outerHeight()}b.css(h)},x.prototype.show=function(e){if(!this.isShown){y(this.options.beforeShow);var f=this;this.isAppended||(d=a(document.body).append(this.popover),b.on("resize.clockpicker"+this.id,function(){f.isShown&&f.locate()}),this.isAppended=!0);var g=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===g[0]){var h=new Date(+new Date+this.options.fromnow);g=[h.getHours(),h.getMinutes()]}this.hours=+g[0]||0,this.minutes=+g[1]||0,this.spanHours.html(n(this.hours)),this.spanMinutes.html(n(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,c.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(b){var c=a(b.target);0===c.closest(f.popover).length&&0===c.closest(f.addon).length&&0===c.closest(f.input).length&&f.hide()}),c.on("keyup.clockpicker."+this.id,function(a){27===a.keyCode&&f.hide()}),y(this.options.afterShow)}},x.prototype.hide=function(){y(this.options.beforeHide),this.isShown=!1,c.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),c.off("keyup.clockpicker."+this.id),this.popover.hide(),y(this.options.afterHide)},x.prototype.toggleView=function(b,c){var d=!1;"minutes"===b&&"visible"===a(this.hoursView).css("visibility")&&(y(this.options.beforeHourSelect),d=!0);var e="hours"===b,f=e?this.hoursView:this.minutesView,g=e?this.minutesView:this.hoursView;this.currentView=b,this.spanHours.toggleClass("text-primary",e),this.spanMinutes.toggleClass("text-primary",!e),g.addClass("clockpicker-dial-out"),f.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(c),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){g.css("visibility","hidden")},v),d&&y(this.options.afterHourSelect)},x.prototype.resetClock=function(a){var b=this.currentView,c=this[b],d="hours"===b,e=Math.PI/(d?6:30),g=c*e,h=d&&c>0&&c<13?s:r,i=Math.sin(g)*h,j=-Math.cos(g)*h,k=this;f&&a?(k.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){k.canvas.removeClass("clockpicker-canvas-out"),k.setHand(i,j)},a)):this.setHand(i,j)},x.prototype.setHand=function(b,c,d,e){var p,g=Math.atan2(b,-c),h="hours"===this.currentView,i=Math.PI/(h||d?6:30),j=Math.sqrt(b*b+c*c),k=this.options,m=h&&j<(r+s)/2,o=m?s:r;if(k.twelvehour&&(o=r),g<0&&(g=2*Math.PI+g),p=Math.round(g/i),g=p*i,k.twelvehour?h?0===p&&(p=12):(d&&(p*=5),60===p&&(p=0)):h?(12===p&&(p=0),p=m?0===p?12:p:0===p?0:p+12):(d&&(p*=5),60===p&&(p=0)),this[this.currentView]!==p&&l&&this.options.vibrate&&(this.vibrateTimer||(navigator[l](10),this.vibrateTimer=setTimeout(a.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=p,this[h?"spanHours":"spanMinutes"].html(n(p)),!f)return void this[h?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var b=a(this);b.toggleClass("active",p===+b.html())});e||!h&&p%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var q=Math.sin(g)*o,t=-Math.cos(g)*o;this.hand.setAttribute("x2",q),this.hand.setAttribute("y2",t),this.bg.setAttribute("cx",q),this.bg.setAttribute("cy",t),this.fg.setAttribute("cx",q),this.fg.setAttribute("cy",t)},x.prototype.done=function(){y(this.options.beforeDone),this.hide();var a=this.input.prop("value"),b=n(this.hours)+":"+n(this.minutes);this.options.twelvehour&&(b+=this.amOrPm),this.input.prop("value",b),b!==a&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),y(this.options.afterDone)},x.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(b.off("resize.clockpicker"+this.id),this.popover.remove())},a.fn.clockpicker=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),e=d.data("clockpicker");if(e)"function"==typeof e[b]&&e[b].apply(e,c);else{var f=a.extend({},x.DEFAULTS,d.data(),"object"==typeof b&&b);d.data("clockpicker",new x(d,f))}})}}();